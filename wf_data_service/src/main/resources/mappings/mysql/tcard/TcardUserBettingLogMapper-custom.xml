<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"
"http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">


<mapper namespace="com.wf.data.dao.tcard.TcardUserBettingLogDao">

    <select id="getGameBettingRecord" resultType="com.wf.data.dao.data.entity.DatawareBettingLogHour">
        SELECT
        user_id userId,
        channel_id channelId,
        COUNT(1) bettingCount,
        SUM(amount) bettingAmount,
        SUM(return_amount) resultAmount,
        DATE_FORMAT(create_time,"%Y-%m-%d") bettingDate,
        DATE_FORMAT(create_time,"%H") bettingHour
        FROM `tcard_user_betting_log`
        WHERE 1=1
        <if test="channelId != null">
            AND channel_id = #{channelId}
        </if>
        AND create_time BETWEEN #{beginDate} AND #{endDate}
        GROUP BY user_id,channel_id,DATE_FORMAT(create_time,"%Y-%m-%d"),DATE_FORMAT(create_time,"%H")
        ORDER BY DATE_FORMAT(create_time,"%Y-%m-%d"),DATE_FORMAT(create_time,"%H")
    </select>
</mapper>

